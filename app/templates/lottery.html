<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–õ–æ—Ç–µ—Ä–µ–π–Ω—ã–π —Ç–∏—Ä–∞–∂</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        .container { background: #1e293b; padding: 20px; border-radius: 12px; }
        h1 { color: #60a5fa; text-align: center; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
        }
        button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }
        .result { margin-top: 20px; }
        .numbers {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 20px 0;
        }
        .number {
            width: 60px;
            height: 60px;
            background: #3b82f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
        }
        .steps {
            margin: 20px 0;
            padding: 15px;
            background: #334155;
            border-radius: 8px;
        }
        .step { margin: 8px 0; color: #94a3b8; }
        .active { color: #60a5fa; font-weight: bold; }
        .tests, .snapshot {
            margin-top: 15px;
            padding: 10px;
            background: #334155;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
        }
        .status { text-align: center; margin: 15px; color: #fbbf24; }
        .error { color: #ef4444; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÆ –õ–æ—Ç–µ—Ä–µ–π–Ω—ã–π —Ç–∏—Ä–∞–∂</h1>
        <p>–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫—É—é —ç–Ω—Ç—Ä–æ–ø–∏—é –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ—Å—Ç–Ω–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏.</p>

        <button id="drawBtn" onclick="startDraw()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–∏—Ä–∞–∂</button>
        <div class="status" id="status"></div>

        <div class="result" id="result" style="display:none;">
            <h2>‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–∏—Ä–∞–∂–∞</h2>
            <div class="numbers" id="numbers"></div>

            <div class="steps">
                <h3>–≠—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏:</h3>
                <div id="steps"></div>
            </div>

            <div class="tests">
                <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã:</strong><br>
                –≠–Ω—Ç—Ä–æ–ø–∏—è: <span id="entropy"></span> –±–∏—Ç/–±–∞–π—Ç<br>
                œá¬≤-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: <span id="chi2"></span>
            </div>

            <div class="snapshot">
                <strong>–¶–∏—Ñ—Ä–æ–≤–æ–π —Å–ª–µ–ø–æ–∫:</strong><br>
                <code id="snapshot"></code>
            </div>
        </div>
    </div>

    <script>
        async function startDraw() {
            const btn = document.getElementById('drawBtn');
            const status = document.getElementById('status');
            const result = document.getElementById('result');

            btn.disabled = true;
            status.textContent = "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–∏—Ä–∞–∂–∞... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.";
            status.className = "status";

            try {
                const res = await fetch('/lottery/draw', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (!res.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞: ${res.status}`);
                }

                const data = await res.json();

                const numbersDiv = document.getElementById('numbers');
                numbersDiv.innerHTML = '';
                data.draw.forEach(num => {
                    const el = document.createElement('div');
                    el.className = 'number';
                    el.textContent = num;
                    numbersDiv.appendChild(el);
                });

                const stepsDiv = document.getElementById('steps');
                stepsDiv.innerHTML = '';
                data.processing_steps.forEach(step => {
                    const el = document.createElement('div');
                    el.className = 'step active';
                    el.textContent = `‚úì ${step}`;
                    stepsDiv.appendChild(el);
                });

                document.getElementById('entropy').textContent = data.tests.entropy_per_byte;
                document.getElementById('chi2').textContent = data.tests.chi_square_stat;

                document.getElementById('snapshot').textContent = data.snapshot_hash;

                result.style.display = 'block';
                status.textContent = "–¢–∏—Ä–∞–∂ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!";
                status.style.color = "#34d399";
            } catch (e) {
                status.textContent = "–û—à–∏–±–∫–∞: " + e.message;
                status.className = "status error";
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>